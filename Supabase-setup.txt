-- Profiles table for all authenticated users
CREATE TABLE profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  twitch_id TEXT UNIQUE,
  username TEXT,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now())
);

-- Moderator relationships
CREATE TABLE moderator_relationships (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  mod_id UUID REFERENCES profiles(id),
  streamer_id UUID REFERENCES profiles(id),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  
  -- Prevent duplicate mod relationships
  UNIQUE(mod_id, streamer_id)
);

-- Game progress table (unchanged)
CREATE TABLE streamer_game_progress (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  streamer_id UUID REFERENCES profiles(id),
  game_title game_title NOT NULL,
  progress_data JSONB NOT NULL,
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT timezone('utc'::text, now()),
  
  UNIQUE(streamer_id, game_title)
);